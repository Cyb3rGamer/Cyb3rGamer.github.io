<html>
<head>
    <title>Free Delisted Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Free Delisted Checker</h1>
    <p>Enter your appids:</p>
    <textarea id="appids" rows="4" cols="50"></textarea>
    <button id="checkAppids">Check Appids</button>
    <div class="result" id="result"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $("#checkAppids")
      .on
        ( "click"
        , async function ()
          { $(this).prop("disabled", true);
            $(this).text("Checking...");
            try
              { const appids =
                  $("#appids").val().split("\n").map(function(line) {
                    return line.trim();
                  }).filter(function(line) {
                    return line.length > 0;
                });

                if ( appids.length === 0 )
                  { alert("Please enter at least one appid.");
                    $(this).prop("disabled", false);
                    $(this).text("Check Appids");
                    return;
                  }

                const response = await fetch("https://steam-tracker.com/api?action=GetAppList");
                const data     = await response.json();

                const grouped =
                  data.reduce
                    ( (acc, item) =>
                      { const key = item.category;
                        if (!acc[key])
                          { acc[key] = []; }
                        acc[key].push(item);
                        return acc;
                      }
                    , {}
                    );

                const owned_grouped =
                  Object.keys(grouped).reduce
                    ( (acc , key) =>
                      { acc[key] = grouped[key].filter(item => appids.includes(item.appid.toString())).length;
                        return acc;
                      }
                    , {}
                    );
                const resultDiv = $("#result");
                resultDiv.empty();

                Object.keys(grouped).forEach
                  ( key =>
                    { const total      = grouped[key].length;
                      const owned      = owned_grouped[key].length;
                      const percentage = ((owned / total) * 100).toFixed(2);
                      resultDiv.append
                        ( `<div>
                             <h3>${key}</h3>
                             <p>Owned: ${owned} / ${total} (${percentage}%)</p>
                           </div>`
                        );
                    }
                  );

                $(this).prop("disabled", false);
                $(this).text("Check Appids");
              }
            catch (e)
              { $(this).prop("disabled", false);
                $(this).text("Check Appids");
                console.error(e);
                alert("An error occurred while checking appids. Please try again.");
              }
          }
        );
    </script>
</html>